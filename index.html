<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Utility Link Cleaner/Extractor</title>
   <style>
      body {
         font-family: Verdana, sans-serif;
         margin: 20px;
      }

      #output {
         margin-top: 20px;
      }

      .error {
         color: red;
      }
   </style>
</head>

<body>
   <h1>Clean Amazon Product Link</h1>
   <form id="azForm">
      <label for="azUrl">Amazon Link:</label><br>
      <input type="text" id="azUrl" name="azUrl" required>
      <button type="submit">Clean</button>
      <p id="azErrorMsg" class="error"></p>
   </form>
   <div id="azOutput"></div>

   <h1>Convert Google Drive Link</h1>
   <p>You'll need to dig up the "Share" link for the file:</p>
   <ol>
      <li>In Google Drive, locate the file</li>
      <li>Show the file's menu by right-clicking on it (or use the three dots)</li>
      <li>Choose Share > Copy link</li>
   </ol>
   <form id="gdForm">
      <label for="gdInput">Google Drive Link:</label><br>
      <input type="text" id="gdInput" name="gdInput" required>
      <button type="submit">Convert</button>
      <p id="gdErrorMsg" class="error"></p>
   </form>
   <div id="gdOutput"></div>

    <script>
      document.getElementById('azForm').addEventListener('submit', function (event) {
         event.preventDefault();
         const urlInput = document.getElementById('azUrl').value.trim();
         const errorMsg = document.getElementById('azErrorMsg');
         const output = document.getElementById('azOutput');

         // Clear previous messages
         errorMsg.textContent = '';
         output.textContent = '';

         // Validate the input
         if (!urlInput) {
            errorMsg.textContent = 'Please enter a valid Amazon link';
            return;
         }

         let urlSplit = urlInput.split("?");
         let urlParts = urlSplit[0].split("/");
         let index = urlParts.findIndex((element) => element.toLowerCase() == "dp");
         if (index > -1) {
            output.textContent = `https://www.amazon.com/dp/${urlParts[index+1]}`;           
         } else {
            found = urlParts.findIndex((element) => element == "gp");
            if (index > -1) {
               output.textContent = `https://www.amazon.com/gp/product${urlParts[index+1]}`;           
            } else {
               errorMsg.textContent = "Please enter a valid Amazon link";
               output.textContent = "";               
            }
         }
      });

      document.getElementById('gdForm').addEventListener('submit', function (event) {
         event.preventDefault();
         const urlInput = document.getElementById('gdUrl').value.trim();
         const errorMsg = document.getElementById('gdErrorMsg');
         const output = document.getElementById('gdOutput');

         // Clear previous messages
         errorMsg.textContent = '';
         output.textContent = '';

         // Validate the input
         if (!urlInput) {
            errorMsg.textContent = 'Please enter a valid Google Drive file link (see instructions above)';
            return;
         }

         let urlSplit = urlInput.split("?");
         let urlParts = urlSplit[0].split("/");
         urlParts.forEach((element, index) => {
            let nugget = urlParts[index + 1].toLowerCase();
            if (nugget == "d") {
               output.textContent = `https://www.amazon.com/dp/${nugget}`;
             } else {
               errorMsg.textContent = "Please enter a valid Google Drive file link (see instructions above)";
               output.textContent = "";
            }
         });
      });
   </script>
</body>

</html>